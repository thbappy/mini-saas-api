# Mini SaaS POS Backend System

ржПржХржЯрж┐ **ржЙржирзНржиржд, ржорж╛рж▓рзНржЯрж┐-ржЯрзЗржирзНржпрж╛ржирзНржЯ ржкржпрж╝рзЗржирзНржЯ ржЕржл рж╕рзЗрж▓ (POS) ржПржмржВ ржЗржиржнрзЗржирзНржЯрж░рж┐ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ рж╕рж┐рж╕рзНржЯрзЗржо** ржпрж╛ Laravel 11 ржПржмржВ MySQL ржжрж┐ржпрж╝рзЗ рждрзИрж░рж┐ред рж╕рж┐рж╕рзНржЯрзЗржоржЯрж┐ рж╕ржорзНржкрзВрж░рзНржгржнрж╛ржмрзЗ API-ржлрж╛рж░рзНрж╕рзНржЯ ржПржмржВ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи-рж░рзЗржбрж┐ред

## ЁЯЪА ржмрзИрж╢рж┐рж╖рзНржЯрзНржпрж╕ржорзВрж╣

### ржорзВрж▓ ржмрзИрж╢рж┐рж╖рзНржЯрзНржп
- тЬЕ **ржорж╛рж▓рзНржЯрж┐-ржЯрзЗржирзНржпрж╛ржирзНржЯ ржЖрж░рзНржХрж┐ржЯрзЗржХржЪрж╛рж░** - ржкрзНрж░рждрж┐ржЯрж┐ ржмрзНржпржмрж╕рж╛ рж╕ржорзНржкрзВрж░рзНржг ржЖрж▓рж╛ржжрж╛ ржбрзЗржЯрж╛ ржЖржЗрж╕рзЛрж▓рзЗрж╢ржи рж╕рж╣
- тЬЕ **API-ржлрж╛рж░рзНрж╕рзНржЯ ржбрж┐ржЬрж╛ржЗржи** - рж╕ржорзНржкрзВрж░рзНржг RESTful API рж╕рж╛ржерзЗ Sanctum Authentication
- тЬЕ **ржнрзВржорж┐ржХрж╛-ржнрж┐рждрзНрждрж┐ржХ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржирж┐ржпрж╝ржирзНрждрзНрж░ржг** - Owner ржПржмржВ Staff ржнрзВржорж┐ржХрж╛
- тЬЕ **ржЙржирзНржиржд ржЗржиржнрзЗржирзНржЯрж░рж┐ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ** - рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ рж╕рзНржЯржХ ржЯрзНрж░рзНржпрж╛ржХрж┐ржВ ржПржмржВ ржХржо рж╕рзНржЯржХ рж╕рждрж░рзНржХрждрж╛
- тЬЕ **ржЕрж░рзНржбрж╛рж░ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ** - ржбрж╛ржЯрж╛ржмрзЗрж╕ ржЯрзНрж░рж╛ржиржЬрзНржпрж╛ржХрж╢ржи рж╕рж╣ ржирж┐рж░рж╛ржкржж ржЕрж░рзНржбрж╛рж░ ржкрзНрж░рж╕рзЗрж╕рж┐ржВ
- тЬЕ **рж░рж┐ржкрзЛрж░рзНржЯрж┐ржВ ржоржбрж┐ржЙрж▓** - ржжрзИржирж┐ржХ ржмрж┐ржХрзНрж░ржпрж╝ рж╕рж╛рж░рж╛ржВрж╢, рж╢рзАрж░рзНрж╖ ржкржгрзНржп, ржХржо рж╕рзНржЯржХ рж░рж┐ржкрзЛрж░рзНржЯ
- тЬЕ **ржЕржкрзНржЯрж┐ржорж╛ржЗржЬржб ржХрзЛржпрж╝рзЗрж░рж┐** - N+1 рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржи ржПржмржВ ржбрзЗржЯрж╛ржмрзЗрж╕ ржЗржирзНржбрзЗржХрзНрж╕рж┐ржВ
- тЬЕ **рж╕ржорзНржкрзВрж░рзНржг ржнрзНржпрж╛рж▓рж┐ржбрзЗрж╢ржи** - Form Request ржПржмржВ ржирж┐ржпрж╝ржорж┐ржд рждрзНрж░рзБржЯрж┐ ржкрж░рж┐ржЪрж╛рж▓ржирж╛

---

## ЁЯУЛ ржкрзНрж░ржпрзБржХрзНрждрж┐ рж╕рзНржЯрзНржпрж╛ржХ

| ржкрзНрж░ржпрзБржХрзНрждрж┐ | рж╕ржВрж╕рзНржХрж░ржг |
|---------|---------|
| PHP | 8.2+ |
| Laravel | 11.x |
| MySQL | 5.7+ |
| Sanctum | 4.x (API Authentication) |

---

## ЁЯПЧя╕П рж╕рж┐рж╕рзНржЯрзЗржо ржЖрж░рзНржХрж┐ржЯрзЗржХржЪрж╛рж░

### ржорж╛рж▓рзНржЯрж┐-ржЯрзЗржирзНржпрж╛ржирзНрж╕рж┐ ржХрзМрж╢рж▓

ржПржЗ рж╕рж┐рж╕рзНржЯрзЗржо **ржбрж╛ржЯрж╛ржмрзЗрж╕-рж▓рзЗржнрзЗрж▓ ржЯрзЗржирзНржпрж╛ржирзНржЯ ржЖржЗрж╕рзЛрж▓рзЗрж╢ржи** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ:

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ         API Request (with X-Tenant-ID)         тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
         тФВ
         тЦ╝
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ  EnsureTenantIsSet Middleware                   тФВ
тФВ  - Tenant ID ржерзЗржХрзЗ Header/Auth User             тФВ
тФВ  - Request attributes-ржП store ржХрж░рж╛             тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
         тФВ
         тЦ╝
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ  TenantScope (Global Scope on Models)          тФВ
тФВ  - рж╕ржорж╕рзНржд queries рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ filter     тФВ
тФВ  - WHERE tenant_id = X ржпрзЛржЧ рж╣ржпрж╝                 тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
         тФВ
         тЦ╝
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ  Database Layer (Isolated Tables)               тФВ
тФВ  - Products (tenant_id indexed)                тФВ
тФВ  - Orders (tenant_id indexed)                  тФВ
тФВ  - Customers (tenant_id indexed)               тФВ
тФВ  - OrderItems (via orders)                     тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

### ржбрзЗржЯрж╛ржмрзЗрж╕ рж╕рзНржХрж┐ржорж╛

**Tenants ржЯрзЗржмрж┐рж▓**
```
tenants
тФЬтФАтФА id (PK)
тФЬтФАтФА name (ржмрзНржпржмрж╕рж╛рж░ ржирж╛ржо)
тФЬтФАтФА slug (ржЕржиржирзНржп рж╕рзНрж▓рж╛ржЧ)
тФЬтФАтФА email
тФЬтФАтФА created_at / updated_at
```

**Users ржЯрзЗржмрж┐рж▓** (ржорзВрж▓ Users ржЯрзЗржмрж┐рж▓рзЗ рж╕ржорзНржкрзНрж░рж╕рж╛рж░ржг)
```
users
тФЬтФАтФА id (PK)
тФЬтФАтФА tenant_id (FK тЖТ tenants)
тФЬтФАтФА name
тФЬтФАтФА email
тФЬтФАтФА password
тФЬтФАтФА role (owner | staff)
тФЬтФАтФА created_at / updated_at
```

**Products ржЯрзЗржмрж┐рж▓**
```
products
тФЬтФАтФА id (PK)
тФЬтФАтФА tenant_id (FK тЖТ tenants) [Index]
тФЬтФАтФА name
тФЬтФАтФА sku (unique per tenant)
тФЬтФАтФА price (decimal)
тФЬтФАтФА stock_quantity [Index]
тФЬтФАтФА low_stock_threshold
тФЬтФАтФА description
тФЬтФАтФА created_at / updated_at
```

**Customers ржЯрзЗржмрж┐рж▓**
```
customers
тФЬтФАтФА id (PK)
тФЬтФАтФА tenant_id (FK тЖТ tenants) [Index]
тФЬтФАтФА name
тФЬтФАтФА email
тФЬтФАтФА phone
тФЬтФАтФА address
тФЬтФАтФА created_at / updated_at
```

**Orders ржЯрзЗржмрж┐рж▓**
```
orders
тФЬтФАтФА id (PK)
тФЬтФАтФА tenant_id (FK тЖТ tenants) [Index]
тФЬтФАтФА customer_id (FK тЖТ customers)
тФЬтФАтФА order_number (unique)
тФЬтФАтФА total_amount (decimal)
тФЬтФАтФА status (pending | paid | cancelled)
тФЬтФАтФА created_at / updated_at [Index]
```

**OrderItems ржЯрзЗржмрж┐рж▓**
```
order_items
тФЬтФАтФА id (PK)
тФЬтФАтФА order_id (FK тЖТ orders)
тФЬтФАтФА product_id (FK тЖТ products)
тФЬтФАтФА quantity
тФЬтФАтФА unit_price
тФЬтФАтФА subtotal
тФЬтФАтФА created_at / updated_at
```

---

## ЁЯФР ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржПржмржВ ржЕржирзБржорзЛржжржи

### Authentication Flow

```bash
# 1. рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи - ржирждрзБржи ржЯрзЗржирзНржпрж╛ржирзНржЯ рждрзИрж░рж┐ ржХрж░рзБржи
POST /api/auth/register
{
    "tenant_name": "ABC Store",
    "tenant_slug": "abc-store",
    "tenant_email": "business@example.com",
    "name": "John Owner",
    "email": "john@example.com",
    "password": "password123",
    "password_confirmation": "password123"
}

# ржкрзНрж░рждрж┐ржХрзНрж░рж┐ржпрж╝рж╛:
{
    "message": "Registration successful",
    "user": { ... },
    "token": "1|abc123xyz..."  # Sanctum Token
}

# 2. рж▓ржЧржЗржи
POST /api/auth/login
Header: X-Tenant-ID: 1
{
    "email": "john@example.com",
    "password": "password123"
}
```

### ржнрзВржорж┐ржХрж╛-ржнрж┐рждрзНрждрж┐ржХ ржирзАрждрж┐ (Policies)

ржкрзНрж░рждрж┐ржЯрж┐ ржоржбрзЗрж▓рзЗрж░ ржЬржирзНржп рж╕ржорзНржкрзВрж░рзНржг ржирзАрждрж┐ рж░ржпрж╝рзЗржЫрзЗ:

- **Owner**: рж╕ржорзНржкрзВрж░рзНржг CRUD + ржорзБржЫрж╛рж░ ржЕржирзБржорждрж┐
- **Staff**: ржкржбрж╝рж╛ ржПржмржВ рждрзИрж░рж┐ ржЕржирзБржорждрж┐ (рж╕рзАржорж┐ржд ржЖржкржбрзЗржЯ)

**ржХрзЛржб ржЙржжрж╛рж╣рж░ржг** (`app/Policies/ProductPolicy.php`):
```php
public function create(User $user): bool
{
    return $user->isOwner();  // рж╢рзБржзрзБ ржорж╛рж▓рж┐ржХ рждрзИрж░рж┐ ржХрж░рждрзЗ ржкрж╛рж░рзЗ
}

public function update(User $user, Product $product): bool
{
    return $user->tenant_id === $product->tenant_id && $user->isOwner();
}
```

---

## ЁЯУж ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи ржПржмржВ рж╕рзЗржЯржЖржк

### ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝рждрж╛
- PHP 8.2 ржмрж╛ ржЙржЪрзНржЪрждрж░
- Composer
- MySQL 5.7 ржмрж╛ ржЙржЪрзНржЪрждрж░

### ржзрж╛ржк 1: ржбрж┐ржкрзЗржирзНржбрзЗржирзНрж╕рж┐ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи

```bash
cd "/path/to/Mini Saas post"
composer install
```

### ржзрж╛ржк 2: ржкрж░рж┐ржмрзЗрж╢ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи

```bash
# .env ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рзБржи
cp .env.example .env

# ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржХрзА рждрзИрж░рж┐ ржХрж░рзБржи
php artisan key:generate

# Sanctum ржорж╛ржЗржЧрзНрж░рзЗрж╢ржи ржкрзНрж░ржХрж╛рж╢ ржХрж░рзБржи
php artisan vendor:publish --provider="Laravel\Sanctum\SanctumServiceProvider"
```

### ржзрж╛ржк 3: .env ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи

```env
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=mini_saas_pos
DB_USERNAME=root
DB_PASSWORD=

SANCTUM_STATEFUL_DOMAINS=localhost,localhost:3000,localhost:8000
```

### ржзрж╛ржк 4: ржбрж╛ржЯрж╛ржмрзЗрж╕ ржорж╛ржЗржЧрзНрж░рзЗрж╢ржи ржПржмржВ рж╕рж┐ржбрж┐ржВ

```bash
# ржбрж╛ржЯрж╛ржмрзЗрж╕ рждрзИрж░рж┐ ржХрж░рзБржи
mysql -u root -e "CREATE DATABASE mini_saas_pos;"

# ржорж╛ржЗржЧрзНрж░рзЗрж╢ржи ржЪрж╛рж▓рж╛ржи ржПржмржВ рж╕рж┐ржб ржХрж░рзБржи
php artisan migrate:fresh --seed

# ржЖржЙржЯржкрзБржЯ:
# тЬУ 2 ржЯрзЗржирзНржпрж╛ржирзНржЯ рждрзИрж░рж┐
# тЬУ 15ржЯрж┐ ржкржгрзНржп ржкрзНрж░рждрж┐ ржЯрзЗржирзНржпрж╛ржирзНржЯ
# тЬУ 10 ржЧрзНрж░рж╛рж╣ржХ ржкрзНрж░рждрж┐ ржЯрзЗржирзНржпрж╛ржирзНржЯ
# тЬУ 50+ ржЕрж░рзНржбрж╛рж░ рж╕рж╣ ржиржорзБржирж╛ ржбрзЗржЯрж╛
```

### ржзрж╛ржк 5: ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржЪрж╛рж▓рж╛ржи

```bash
php artisan serve
# ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржЪрж▓ржЫрзЗ http://localhost:8000
```

---

## ЁЯФМ API ржПржирзНржбржкржпрж╝рзЗржирзНржЯ

### ржкрзНрж░ржорж╛ржгрзАржХрж░ржг

```bash
POST /api/auth/register          # ржирждрзБржи ржЯрзЗржирзНржпрж╛ржирзНржЯ рждрзИрж░рж┐ ржХрж░рзБржи
POST /api/auth/login             # рж▓ржЧржЗржи ржХрж░рзБржи
POST /api/auth/logout            # рж▓ржЧржЖржЙржЯ ржХрж░рзБржи (ржЕржирзБржорзЛржжрж┐ржд)
GET  /api/auth/me                # ржмрж░рзНрждржорж╛ржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрж╛ржи (ржЕржирзБржорзЛржжрж┐ржд)
```

### ржкржгрзНржп ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ

```bash
GET    /api/products             # рж╕ржорж╕рзНржд ржкржгрзНржп рждрж╛рж▓рж┐ржХрж╛ (ржЕржирзБржорзЛржжрж┐ржд)
POST   /api/products             # ржирждрзБржи ржкржгрзНржп рждрзИрж░рж┐ ржХрж░рзБржи (Owner only)
GET    /api/products/{id}        # ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржкржгрзНржп ржкрж╛ржи (ржЕржирзБржорзЛржжрж┐ржд)
PUT    /api/products/{id}        # ржкржгрзНржп ржЖржкржбрзЗржЯ ржХрж░рзБржи (Owner only)
DELETE /api/products/{id}        # ржкржгрзНржп ржорзБржЫрзБржи (Owner only)

# Query ржкрзНржпрж╛рж░рж╛ржорж┐ржЯрж╛рж░:
?search=ржирж╛ржо                      # ржирж╛ржо ржжрзНржмрж╛рж░рж╛ ржЕржирзБрж╕ржирзНржзрж╛ржи ржХрж░рзБржи
?low_stock=1                     # рж╢рзБржзрзБржорж╛рждрзНрж░ ржХржо рж╕рзНржЯржХ ржкржгрзНржп
?sort_by=created_at              # рж╕рж░рзНржЯрж┐ржВ ржлрж┐рж▓рзНржб
?sort_order=desc                 # asc ржмрж╛ desc
?per_page=15                     # ржкрзНрж░рждрж┐ ржкрзГрж╖рзНржарж╛ржпрж╝ ржЖржЗржЯрзЗржо
```

### ржЧрзНрж░рж╛рж╣ржХ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ

```bash
GET    /api/customers            # рж╕ржорж╕рзНржд ржЧрзНрж░рж╛рж╣ржХ (ржЕржирзБржорзЛржжрж┐ржд)
POST   /api/customers            # ржирждрзБржи ржЧрзНрж░рж╛рж╣ржХ рждрзИрж░рж┐ ржХрж░рзБржи (ржЕржирзБржорзЛржжрж┐ржд)
GET    /api/customers/{id}       # ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржЧрзНрж░рж╛рж╣ржХ (ржЕржирзБржорзЛржжрж┐ржд)
PUT    /api/customers/{id}       # ржЧрзНрж░рж╛рж╣ржХ ржЖржкржбрзЗржЯ ржХрж░рзБржи (ржЕржирзБржорзЛржжрж┐ржд)
DELETE /api/customers/{id}       # ржЧрзНрж░рж╛рж╣ржХ ржорзБржЫрзБржи (Owner only)
```

### ржЕрж░рзНржбрж╛рж░ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ

```bash
GET    /api/orders               # рж╕ржорж╕рзНржд ржЕрж░рзНржбрж╛рж░ (ржЕржирзБржорзЛржжрж┐ржд)
POST   /api/orders               # ржирждрзБржи ржЕрж░рзНржбрж╛рж░ рждрзИрж░рж┐ ржХрж░рзБржи (ржЕржирзБржорзЛржжрж┐ржд)
GET    /api/orders/{id}          # ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржЕрж░рзНржбрж╛рж░ (ржЕржирзБржорзЛржжрж┐ржд)
POST   /api/orders/{id}/mark-as-paid   # ржЕрж░рзНржбрж╛рж░ ржкрзЗржорзЗржирзНржЯ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи
POST   /api/orders/{id}/cancel         # ржЕрж░рзНржбрж╛рж░ ржмрж╛рждрж┐рж▓ ржХрж░рзБржи

# Query ржкрзНржпрж╛рж░рж╛ржорж┐ржЯрж╛рж░:
?status=paid                     # рж╕рзНржерж┐рждрж┐ ржжрзНржмрж╛рж░рж╛ ржлрж┐рж▓рзНржЯрж╛рж░ (pending|paid|cancelled)
?customer_id=1                   # ржЧрзНрж░рж╛рж╣ржХ ржжрзНржмрж╛рж░рж╛ ржлрж┐рж▓рзНржЯрж╛рж░
```

### рж░рж┐ржкрзЛрж░рзНржЯрж┐ржВ

```bash
GET /api/reports/daily-sales     # ржжрзИржирж┐ржХ ржмрж┐ржХрзНрж░ржпрж╝ рж╕рж╛рж░рж╛ржВрж╢
GET /api/reports/top-selling-products  # рж╢рзАрж░рзНрж╖ 5 ржмрж┐ржХрзНрж░ржпрж╝ ржкржгрзНржп
GET /api/reports/low-stock       # ржХржо рж╕рзНржЯржХ рж░рж┐ржкрзЛрж░рзНржЯ

# Query ржкрзНржпрж╛рж░рж╛ржорж┐ржЯрж╛рж░:
?date=2026-01-06                 # ржжрзИржирж┐ржХ ржмрж┐ржХрзНрж░ржпрж╝рзЗрж░ ржЬржирзНржп рждрж╛рж░рж┐ржЦ
?start_date=2026-01-01           # рж╢рзАрж░рзНрж╖ ржкржгрзНржпрзЗрж░ ржЬржирзНржп рж╢рзБрж░рзБ рждрж╛рж░рж┐ржЦ
?end_date=2026-01-31             # рж╢рзАрж░рзНрж╖ ржкржгрзНржпрзЗрж░ ржЬржирзНржп рж╢рзЗрж╖ рждрж╛рж░рж┐ржЦ
```

---

## ЁЯУи API ржЙржжрж╛рж╣рж░ржг

### ржЙржжрж╛рж╣рж░ржг 1: ржирждрзБржи ржЯрзЗржирзНржпрж╛ржирзНржЯ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи

```bash
curl -X POST http://localhost:8000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "tenant_name": "TechStore",
    "tenant_slug": "techstore",
    "tenant_email": "info@techstore.com",
    "name": "Ahmed Khan",
    "email": "ahmed@techstore.com",
    "password": "SecurePass123",
    "password_confirmation": "SecurePass123"
  }'
```

**ржкрзНрж░рждрж┐ржХрзНрж░рж┐ржпрж╝рж╛:**
```json
{
  "message": "Registration successful",
  "user": {
    "id": 1,
    "name": "Ahmed Khan",
    "email": "ahmed@techstore.com",
    "role": "owner",
    "tenant_id": 1
  },
  "token": "1|abcdef123456xyz"
}
```

### ржЙржжрж╛рж╣рж░ржг 2: ржкржгрзНржп рждрзИрж░рж┐ ржХрж░рзБржи

```bash
curl -X POST http://localhost:8000/api/products \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -H "X-Tenant-ID: 1" \
  -d '{
    "name": "Laptop Dell",
    "sku": "LAPTOP-DELL-001",
    "price": 85000,
    "stock_quantity": 50,
    "low_stock_threshold": 10,
    "description": "Powerful laptop for professionals"
  }'
```

### ржЙржжрж╛рж╣рж░ржг 3: ржЕрж░рзНржбрж╛рж░ рждрзИрж░рж┐ ржХрж░рзБржи (рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ рж╕рзНржЯржХ ржбрзЗржбрж╛ржХрж╢ржи)

```bash
curl -X POST http://localhost:8000/api/orders \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -H "X-Tenant-ID: 1" \
  -d '{
    "customer_id": 1,
    "items": [
      {
        "product_id": 5,
        "quantity": 2
      },
      {
        "product_id": 8,
        "quantity": 1
      }
    ]
  }'
```

**ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛:**
1. ржЧрзНрж░рж╛рж╣ржХ ржмрзИржзрждрж╛ ржЪрзЗржХ ржХрж░рзБржи
2. ржкрзНрж░рждрж┐ржЯрж┐ ржкржгрзНржпрзЗрж░ рж╕рзНржЯржХ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
3. ржпржжрж┐ ржкрж░рзНржпрж╛ржкрзНржд рж╣ржпрж╝ рждржмрзЗ **ржЯрзНрж░рж╛ржиржЬрзНржпрж╛ржХрж╢ржирзЗ** рж╕рзНржЯржХ ржХржорж╛ржи
4. ржЕрж░рзНржбрж╛рж░ ржПржмржВ OrderItems рждрзИрж░рж┐ ржХрж░рзБржи

---

## ЁЯЧГя╕П ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЕржкржЯрж┐ржорж╛ржЗржЬрзЗрж╢ржи

### ржбрж╛ржЯрж╛ржмрзЗрж╕ ржЗржирзНржбрзЗржХрзНрж╕рж┐ржВ

```sql
-- products ржЯрзЗржмрж┐рж▓рзЗ рж╕рзВржЪржХ
tenant_id
(tenant_id, sku)          -- Unique composite
(tenant_id, stock_quantity)

-- orders ржЯрзЗржмрж┐рж▓рзЗ рж╕рзВржЪржХ
tenant_id
customer_id
(tenant_id, status)
(tenant_id, created_at)

-- customers ржЯрзЗржмрж┐рж▓рзЗ рж╕рзВржЪржХ
tenant_id
(tenant_id, email)
```

### Eager Loading (N+1 рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржи)

**ржЖржЧрзЗ (N+1 рж╕ржорж╕рзНржпрж╛):**
```php
$orders = Order::all();  // 1 query
foreach ($orders as $order) {
    echo $order->customer->name;  // N queries
}
// ржорзЛржЯ: N+1 queries
```

**ржПржЦржи (ржЕржкрзНржЯрж┐ржорж╛ржЗржЬржб):**
```php
$orders = Order::with('customer', 'items.product')->get();  // 1 query with joins
foreach ($orders as $order) {
    echo $order->customer->name;  // No additional queries
}
```

### ржХрзЛржпрж╝рзЗрж░рж┐ ржЕржкржЯрж┐ржорж╛ржЗржЬрзЗрж╢ржи ржЙржжрж╛рж╣рж░ржг

**рж░рж┐ржкрзЛрж░рзНржЯрж┐ржВ ржХрзЛржпрж╝рзЗрж░рж┐:**
```php
// Top selling products - рж╕рж┐ржЩрзНржЧрзЗрж▓ ржЕржкрзНржЯрж┐ржорж╛ржЗржЬржб ржХрзЛржпрж╝рзЗрж░рж┐
$topProducts = OrderItem::query()
    ->join('orders', 'order_items.order_id', '=', 'orders.id')
    ->join('products', 'order_items.product_id', '=', 'products.id')
    ->where('orders.tenant_id', $tenantId)
    ->where('orders.status', 'paid')
    ->whereBetween('orders.created_at', [$start, $end])
    ->select('products.id', 'products.name')
    ->selectRaw('COUNT(*) as quantity_sold, SUM(order_items.subtotal) as revenue')
    ->groupBy('products.id', 'products.name')
    ->orderByDesc('quantity_sold')
    ->limit(5)
    ->get();
// ржПржХ ржПржХржХ aggregated ржХрзЛржпрж╝рзЗрж░рж┐ - рж╕рж╣ржЬ ржПржмржВ ржжрзНрж░рзБржд!
```

---

## ЁЯФР ржЕрж░рзНржбрж╛рж░ ржЯрзНрж░рж╛ржиржЬрзНржпрж╛ржХрж╢ржи ржлрзНрж▓рзЛ

```php
DB::transaction(function () {
    // Step 1: рж╕рзНржЯржХ ржкрж░рзАржХрзНрж╖рж╛ ржПржмржВ ржмрзИржзрждрж╛
    foreach ($items as $item) {
        $product = Product::find($item->product_id);
        if ($product->stock_quantity < $item->quantity) {
            throw new Exception('Insufficient stock');
        }
    }
    
    // Step 2: рж╕рзНржЯржХ ржХржорж╛ржи (Atomic)
    foreach ($items as $item) {
        $product->decrement('stock_quantity', $item->quantity);
    }
    
    // Step 3: ржЕрж░рзНржбрж╛рж░ ржПржмржВ ржЖржЗржЯрзЗржо рждрзИрж░рж┐ ржХрж░рзБржи (Atomic)
    $order = Order::create([...]);
    foreach ($items as $item) {
        $order->items()->create([...]);
    }
    
    // ржпржжрж┐ ржХрзЛржирзЛ рждрзНрж░рзБржЯрж┐ ржЖрж╕рзЗ тЖТ рж╕ржорзНржкрзВрж░рзНржг rollback
});
```

---

## ЁЯУК рж╕рж┐ржб ржбрзЗржЯрж╛

`php artisan migrate:fresh --seed` ржЪрж╛рж▓рж╛ржирзЛрж░ ржкрж░рзЗ ржЖржкржирж┐ ржкрж╛ржмрзЗржи:

- **2 ржЯрзЗржирзНржпрж╛ржирзНржЯ**
  - ржкрзНрж░рждрж┐ржЯрж┐рж░ 1 ржорж╛рж▓рж┐ржХ ржПржмржВ 2 ржХрж░рзНржоржЪрж╛рж░рзА ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА
  
- **15 ржкржгрзНржп ржкрзНрж░рждрж┐ ржЯрзЗржирзНржпрж╛ржирзНржЯ**
  - SKU, ржорзВрж▓рзНржп, рж╕рзНржЯржХ ржкрж░рж┐ржорж╛ржг рж╕рж╣
  - ржмрж┐ржнрж┐ржирзНржи ржХржо рж╕рзНржЯржХ ржерзНрж░рзЗрж╢рж╣рзЛрж▓рзНржб
  
- **10 ржЧрзНрж░рж╛рж╣ржХ ржкрзНрж░рждрж┐ ржЯрзЗржирзНржпрж╛ржирзНржЯ**
  
- **50+ ржЕрж░рзНржбрж╛рж░ рж╕рж╣ ржиржорзБржирж╛ ржбрзЗржЯрж╛**
  - ржмрж┐ржнрж┐ржирзНржи рж╕рзНржерж┐рждрж┐ (ржкрзЗржирзНржбрж┐ржВ, ржкрзЗржорзЗржирзНржЯржкрзНрж░рж╛ржкрзНржд, ржмрж╛рждрж┐рж▓)
  - ржкрзНрж░рждрж┐ржЯрж┐ ржЕрж░рзНржбрж╛рж░рзЗ 1-3 ржЖржЗржЯрзЗржо

---

## я┐╜я┐╜ ржбрж┐ржмрж╛ржЧрж┐ржВ ржПржмржВ ржкрж░рзАржХрзНрж╖рж╛

### рж╕рж╛ржзрж╛рж░ржг рж╕ржорж╕рзНржпрж╛

**рж╕ржорж╕рзНржпрж╛**: `SQLSTATE[HY000]: General error: 1824`
**рж╕ржорж╛ржзрж╛ржи**: ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи ржорж╛ржЗржЧрзНрж░рзЗрж╢ржи ржЕрж░рзНржбрж╛рж░ рж╕ржарж┐ржХ (ржЯрзЗржирзНржпрж╛ржирзНржЯ тЖТ ржЗржЙржЬрж╛рж░ тЖТ ржкржгрзНржп тЖТ ржЕрж░рзНржбрж╛рж░)

**рж╕ржорж╕рзНржпрж╛**: `Unauthorized tenant access`
**рж╕ржорж╛ржзрж╛ржи**: ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи `X-Tenant-ID` рж╣рзЗржбрж╛рж░ рж╕ржарж┐ржХржнрж╛ржмрзЗ ржкрж╛ржарж╛ржирзЛ рж╣ржпрж╝рзЗржЫрзЗ

**рж╕ржорж╕рзНржпрж╛**: `Insufficient stock error`
**рж╕ржорж╛ржзрж╛ржи**: ржкржгрзНржп рж╕рзНржЯржХ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи ржПржмржВ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи `stock_quantity >= quantity`

---

## ЁЯУЭ ржбрж┐ржЬрж╛ржЗржи рж╕рж┐ржжрзНржзрж╛ржирзНржд ржПржмржВ ржЯрзНрж░рзЗржб-ржЕржл

| рж╕рж┐ржжрзНржзрж╛ржирзНржд | ржХрж╛рж░ржг | ржЯрзНрж░рзЗржб-ржЕржл |
|---------|------|---------|
| **ржЯрзЗржирзНржпрж╛ржирзНржЯ рж╕рзНржХрзЛржк Middleware** | ржбрзЗржЯрж╛ рж▓рж┐ржХ ржкрзНрж░рждрж┐рж░рзЛржз | ржорж╛ржЗржирж░ ржУржнрж╛рж░рж╣рзЗржб ржкрзНрж░рждрж┐ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ |
| **Eager Loading** | N+1 рж╕ржорж╕рзНржпрж╛ ржПржбрж╝рж╛ржи | ржорзЗржорж░рж┐ ржмрзНржпржмрж╣рж╛рж░ ржпржжрж┐ ржмржбрж╝ ржбрзЗржЯрж╛рж╕рзЗржЯ |
| **Database Transactions** | ржбрзЗржЯрж╛ рж╕рж╛ржоржЮрзНржЬрж╕рзНржп | рж╕рж╛ржорж╛ржирзНржп ржмрж┐рж▓ржорзНржм (ms рждрзЗ) |
| **Policies over Gates** | ржЖрж░рзЛ рж░ржХрзНрж╖ржгрж╛ржмрзЗржХрзНрж╖ржгржпрзЛржЧрзНржп | ржкрзНрж░рждрж┐ржЯрж┐ ржоржбрзЗрж▓рзЗрж░ ржЬржирзНржп ржХрзНрж▓рж╛рж╕ рждрзИрж░рж┐ |
| **Form Requests** | ржкрзБржиржГржмрзНржпржмрж╣рж╛рж░ржпрзЛржЧрзНржп ржнрзНржпрж╛рж▓рж┐ржбрзЗрж╢ржи | рж╕рж╛ржорж╛ржирзНржп ржХрзЛржбржмрзЗрж╕ ржмрзГржжрзНржзрж┐ |

---

## ЁЯУж ржлрж╛ржЗрж▓ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░

```
mini-saas-pos/
тФЬтФАтФА app/
тФВ   тФЬтФАтФА Http/
тФВ   тФВ   тФЬтФАтФА Controllers/Api/
тФВ   тФВ   тФВ   тФЬтФАтФА AuthController.php
тФВ   тФВ   тФВ   тФЬтФАтФА ProductController.php
тФВ   тФВ   тФВ   тФЬтФАтФА CustomerController.php
тФВ   тФВ   тФВ   тФЬтФАтФА OrderController.php
тФВ   тФВ   тФВ   тФФтФАтФА ReportController.php
тФВ   тФВ   тФЬтФАтФА Middleware/
тФВ   тФВ   тФВ   тФФтФАтФА EnsureTenantIsSet.php
тФВ   тФВ   тФЬтФАтФА Requests/
тФВ   тФВ   тФВ   тФЬтФАтФА StoreProductRequest.php
тФВ   тФВ   тФВ   тФЬтФАтФА UpdateProductRequest.php
тФВ   тФВ   тФВ   тФЬтФАтФА StoreCustomerRequest.php
тФВ   тФВ   тФВ   тФФтФАтФА StoreOrderRequest.php
тФВ   тФВ   тФФтФАтФА Resources/
тФВ   тФВ       тФЬтФАтФА ProductResource.php
тФВ   тФВ       тФЬтФАтФА CustomerResource.php
тФВ   тФВ       тФЬтФАтФА OrderResource.php
тФВ   тФВ       тФФтФАтФА OrderItemResource.php
тФВ   тФЬтФАтФА Models/
тФВ   тФВ   тФЬтФАтФА Tenant.php
тФВ   тФВ   тФЬтФАтФА User.php (extended)
тФВ   тФВ   тФЬтФАтФА Product.php
тФВ   тФВ   тФЬтФАтФА Customer.php
тФВ   тФВ   тФЬтФАтФА Order.php
тФВ   тФВ   тФЬтФАтФА OrderItem.php
тФВ   тФВ   тФФтФАтФА Scopes/TenantScope.php
тФВ   тФЬтФАтФА Policies/
тФВ   тФВ   тФЬтФАтФА ProductPolicy.php
тФВ   тФВ   тФЬтФАтФА CustomerPolicy.php
тФВ   тФВ   тФФтФАтФА OrderPolicy.php
тФВ   тФФтФАтФА Providers/
тФВ       тФФтФАтФА AppServiceProvider.php
тФЬтФАтФА database/
тФВ   тФЬтФАтФА migrations/
тФВ   тФВ   тФЬтФАтФА 2026_01_06_000100_create_tenants_table.php
тФВ   тФВ   тФЬтФАтФА 2026_01_06_000200_add_tenant_id_to_users_table.php
тФВ   тФВ   тФЬтФАтФА 2026_01_06_000300_create_products_table.php
тФВ   тФВ   тФЬтФАтФА 2026_01_06_000400_create_customers_table.php
тФВ   тФВ   тФЬтФАтФА 2026_01_06_000500_create_orders_table.php
тФВ   тФВ   тФФтФАтФА 2026_01_06_000600_create_order_items_table.php
тФВ   тФЬтФАтФА factories/
тФВ   тФВ   тФЬтФАтФА TenantFactory.php
тФВ   тФВ   тФЬтФАтФА ProductFactory.php
тФВ   тФВ   тФЬтФАтФА CustomerFactory.php
тФВ   тФВ   тФФтФАтФА OrderFactory.php
тФВ   тФФтФАтФА seeders/
тФВ       тФЬтФАтФА TenantSeeder.php
тФВ       тФФтФАтФА DatabaseSeeder.php
тФЬтФАтФА routes/
тФВ   тФФтФАтФА api.php
тФЬтФАтФА .env
тФФтФАтФА README.md
```

---

## ЁЯЪА ржкрж░ржмрж░рзНрждрзА ржзрж╛ржк (ржнржмрж┐рж╖рзНржпрждрзЗрж░ ржЙржирзНржирждрж┐)

- [ ] PHPUnit ржлрж┐ржЪрж╛рж░ ржЯрзЗрж╕рзНржЯ ржпрзЛржЧ ржХрж░рзБржи
- [ ] Swagger/OpenAPI ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи
- [ ] Background Jobs for Reports (Queue)
- [ ] Multi-language рж╕рж╛ржкрзЛрж░рзНржЯ
- [ ] Payment Gateway ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи
- [ ] рж░рж┐ржпрж╝рзЗрж▓-ржЯрж╛ржЗржо ржирзЛржЯрж┐ржлрж┐ржХрзЗрж╢ржи (Websockets)

---

## ЁЯУЮ рж╕рж╣рж╛ржпрж╝рждрж╛

ржпрзЗржХрзЛржирзЛ рж╕ржорж╕рзНржпрж╛рж░ ржЬржирзНржп, рж▓ржЧржлрж╛ржЗрж▓ржЧрзБрж▓рж┐ ржЪрзЗржХ ржХрж░рзБржи:
```bash
tail -f storage/logs/laravel.log
```

---

**ржкрзНрж░ржЬрзЗржХрзНржЯ рждрзИрж░рж┐:** January 2026  
**рж╕рзНржерж┐рждрж┐:** ржкрзНрж░рзЛржбрж╛ржХрж╢ржи-рж░рзЗржбрж┐ тЬЕ

